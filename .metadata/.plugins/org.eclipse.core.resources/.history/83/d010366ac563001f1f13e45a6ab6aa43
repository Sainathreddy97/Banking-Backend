package com.authenticate.controller;

import java.util.List;
import java.util.stream.Collectors;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.authenticate.dto.LoginRequest;
import com.authenticate.dto.UserDto;
import com.authenticate.entity.User;
import com.authenticate.mapper.UserMapper;
import com.authenticate.service.UserServiceImpl;

@RestController
@RequestMapping("/user")
public class UserController {
	Logger logger = LoggerFactory.getLogger(UserController.class);

	@Autowired
	 UserServiceImpl userServiceImpl;
	@GetMapping("/{id}")
	public ResponseEntity<UserDto> getUserById(@PathVariable long id) {
		logger.trace("Starting getUserbyid method in userController class by trace");
		logger.info("Starting getUserbyid method in userController class by info ");
		UserDto getUser = userServiceImpl.getUser(id);
		return new ResponseEntity<>(getUser, HttpStatus.OK);
	}
	
	@GetMapping("/users")
    public ResponseEntity<List<UserDto>> getAllUsers() {
        List<User> users = userServiceImpl.getAllUsers();
        List<UserDto> userDtos = users.stream()
                                      .map(UserMapper::mapToUserDto)
                                      .collect(Collectors.toList());
        return ResponseEntity.ok(userDtos);
    }
	@PostMapping("/login")
    public ResponseEntity<String> login(@RequestBody LoginRequest loginRequest) {
        logger.info("Login request received for username/email: {}", loginRequest.getUsernameOrEmail());
        User user = userServiceImpl.authenticate(loginRequest.getUsernameOrEmail(), loginRequest.getPassword());
        if (user != null) {
            return ResponseEntity.ok("You have logged in successfully!");
        } else {
            return ResponseEntity.status(401).body("Login not successful. Please try again.");
        }
    }
}
